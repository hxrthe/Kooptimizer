{% extends 'base.html' %}

{% block content %}
<div class="first-login-setup" style="max-width:480px;margin:40px auto;padding:20px;border-radius:8px;background:#fff;">
    <h1>Account Setup</h1>
    
    {# Messages are rendered globally by base.html (floating) #}

    {% if not show_otp_form and not show_password_form %}
    <div class="verification-start">
        <p>To secure your account, we need to verify your phone number first.</p>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="send_otp">
            <button type="submit" class="btn btn-primary">Send Verification Code</button>
        </form>
    </div>
    {% endif %}

    {% if show_otp_form %}
    <div class="otp-verification">
        <p>Please enter the verification code sent to your phone.</p>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="verify_otp">
            <div class="form-group">
                <label for="otp_code">Verification Code</label>
                <input type="text" name="otp_code" id="otp_code" required class="form-control" 
                       pattern="[0-9]*" inputmode="numeric" maxlength="4">
            </div>
            <div style="margin-top:16px;display:flex;gap:8px;">
                <button type="submit" class="btn btn-primary">Verify Code</button>
                <form method="post" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="send_otp">
                    <button type="submit" class="btn btn-secondary">Resend Code</button>
                </form>
            </div>
        </form>
    </div>
    {% endif %}

    {% if show_password_form %}
    <div class="password-setup">
        <p>Please set a new password for your account. Password must be at least 8 characters.</p>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="change_password">
            
            <div class="form-group">
                <label for="new_password">New password</label>
                <input type="password" name="new_password" id="new_password" 
                       required minlength="8" class="form-control">
            </div>

            <div class="form-group">
                <label for="confirm_password">Confirm password</label>
                <input type="password" name="confirm_password" id="confirm_password" 
                       required minlength="8" class="form-control">
            </div>

            <div style="margin-top:16px;display:flex;gap:8px;">
                <button type="submit" class="btn btn-primary">Save password</button>
                <a href="{% url 'logout' %}" class="btn btn-secondary" 
                   style="text-decoration:none;padding:8px 12px;border-radius:4px;">Cancel</a>
            </div>
        </form>
    </div>
    {% endif %}
</div>

<style>
.form-group {
    margin-bottom: 1rem;
}
.form-group label {
    display: block;
    margin-bottom: 0.5rem;
}
.form-control {
    width: 100%;
    padding: 0.375rem 0.75rem;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
}
.alert {
    padding: 0.75rem 1.25rem;
    margin-bottom: 1rem;
    border: 1px solid transparent;
    border-radius: 0.25rem;
}
.alert-success {
    color: #155724;
    background-color: #d4edda;
    border-color: #c3e6cb;
}
.alert-danger {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
}
.alert-warning {
    color: #856404;
    background-color: #fff3cd;
    border-color: #ffeeba;
}
</style>
{% endblock %}